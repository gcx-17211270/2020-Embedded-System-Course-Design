# 改动文件

`对main.c文件里面改动说明的一个简要提取，并加一些说明，以便于对于内容的重现`

## 2020.10.27改动说明——————高成鑫

### STM32CubeMax:

ADC1进行了初始化---------------配置使用TIM2作为外部时钟源，具体配置如Img文件夹下![ADC](Img/20201027/20201027_023549_ADC1_Temp.png)(图中未体现开启中断)![定时器](Img/20201027/2020_1027_032224_TIM2.png)所示 ,ADC可选择使用IN0外接模拟温度转换，或者Temperature使用内部温度转换

### IAR今日改动位置：

main.c:

       USER CODE BEGIN PD---------------1.添加了两个互斥的#define，在使用时根据使用的时外部的模拟温度转换模块还是内部的时钟做出选择
       USER CODE BEGIN PV---------------2.增添了在使用IN0或内部温度测量时使用的全局变量
       USER CODE BEGIN 0----------------3.使用IN0和IN18时候的回调函数重写，他们的主要区别在于AD读数不同从而公式不同，还有，该公式正确性待检验
       USER CODE BEGIN 2----------------4.开启定时器TIM2以及ADC的中断（两个IN口都会使用）

### 其他说明：

缩进的printf表示调试过程中查看变量使用的，在正式使用中要被注释掉

## 2020.10.28改动说明

### 遇到的问题

在同时使用ADC采集温度信号和使用红外接收模块时候，会产生红外信号接受不完全的情况，试图提高红外接收模块的中断优先级，看看效果怎么样。（并没有什么nuan用）最后的解决是注释掉了所有的printf，（顺带的修改了TIM2和ADC的中断优先级）。

### STM32CubeMax修改

ADC更改 ADC1IN0改ADC3IN8

       为了便于实时测量温度，使用了外部的模拟温度传感器，不再使用IN18的temperature传感器，删除了相关的程序,将外部传感器的插口进行了更改，现在使用ADC3的IN8口作为输入，（对应扩展板上的A1位置），现在使用TIM1作为比较时钟

TIM1用作外部触发中断源External Trigger Conversion Source

       配置同之前的TIM2相同
       
TIM2更改

       现在将TIM2作为输入捕获使用，chanal1 chanal2分别为主从模式，用于捕获下降沿和上升沿
       
相关的配置情况如Image文件夹中![ADC3](Img/20201028/20201028_161138_ADC3.png)、![TIM1_1](Img/20201028/20201028_161349_TIM1_1.png)、![TIM1_2](Img/20201028/20201028_161445_TIM1_2.png)、![TIM2](Img/20201028/20201028_161532_TIM2.png)所示

### IAR今日改动位置

main.c:

       USER CODE BEGIN PV---------------1.增添了在输入捕获时候使用的全局变量
       USER CODE BEGIN 0----------------2.输入捕获的回调函数
       USER CODE BEGIN 2----------------3.开启定时器TIM2通道1和2输入捕获的中断（最终使用的只有TIM2 Channal1的中断）
其他说明：
       缩进的printf表示调试过程中查看变量使用的，在正式使用中要被注释掉
